#!/bin/bash
set -e
#read -p "package (ex.: com.exemplo.app): " PACKAGE
PACKAGE=$1

if [ -z "$PACKAGE" ]; then
  echo "Erro: Informe o pacote (ex: com.exemplo.app)"
  exit 1
fi

APPNAME=$(echo $PACKAGE | cut -d'.' -f2)

if [ -z "$APPNAME" ] || [ "$APPNAME" == "$PACKAGE" ]; then
    APPNAME=$(echo $PACKAGE | cut -d'.' -f1)
fi

echo "Iniciando projeto: $APPNAME"
echo "Package: $PACKAGE"

if [ -d "$APPNAME" ]; then
  echo
  echo "Diretorio jÃ¡ existe"
  exit 1
fi

PKG_PATH=$(echo $PACKAGE | tr '.' '/')

mkdir -p $APPNAME/src/$PKG_PATH/{core,android}
mkdir -p $APPNAME/res/{drawable,layout,values,mipmap-xxxhdpi}
mkdir -p $APPNAME/{assets,libs}

cat > $APPNAME/AndroidManifest.xml <<EOF
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="$PACKAGE"
    android:versionCode="1"
    android:versionName="1.0">
    <uses-sdk
        android:minSdkVersion="31"
        android:targetSdkVersion="31"/>

   <!-- para adiciona icon no apk do app vai na pasta res/mipmap-xxxhdpi/ e adicione
        o icon como o tamanho minimo 96x96 para cima e adiciona a dentro da tag 
        <application android:icon="@mipmap/image">...</application> -->

    <application
        android:label="@string/app_name"
        android:debuggable="true" 
        android:allowBackup="true"
        android:theme="@android:style/Theme.Material.Light.NoActionBar">
        <activity android:name=".android.MainActivity"
                 android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.MAIN"/>
                <category android:name="android.intent.category.LAUNCHER"/>
            </intent-filter>
        </activity>
    </application>
</manifest>
EOF

cat > $APPNAME/src/$PKG_PATH/core/AppCore.java <<EOF
package $PACKAGE.core;

public class AppCore{
    private int counter = 0;

    public String click() {
        counter++;
        return "Cliques: " + counter;
    }
}

EOF

cat > $APPNAME/src/$PKG_PATH/android/MainActivity.java <<EOF
package $PACKAGE.android;

import $PACKAGE.R;
import android.app.Activity;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.TextView;

import $PACKAGE.core.AppCore;

public class MainActivity extends Activity {

    private AppCore core = new AppCore();

    @Override
    protected void onCreate(Bundle b) {
        super.onCreate(b);
        setContentView(R.layout.activity_main);
        Button btn = findViewById(R.id.button_click);

        TextView txt = findViewById(R.id.text_counter);
        btn.setOnClickListener(new View.OnClickListener() {
                @Override
                public void onClick(View v) {
                    txt.setText(core.click());
                }
            });
    }
}
EOF

cat > $APPNAME/res/values/strings.xml <<EOF
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <string name="app_name">$APPNAME</string>
</resources>
EOF

cat > $APPNAME/res/values/colors.xml <<EOF
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <color name="black">#FF000000</color>
    <color name="white">#FFFFFFFF</color>
</resources>
EOF

cat > $APPNAME/res/values/styles.xml <<EOF
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <style name="button">
        <item name="android:layout_width">match_parent</item>
        <item name="android:layout_height">100dp</item>
        <item name="android:textColor">@color/black</item>
        <item name="android:gravity">center</item>
        <item name="android:textSize">20sp</item>
    </style>
</resources>
EOF

cat > $APPNAME/res/layout/activity_main.xml <<EOF
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:background="@color/white"
    android:gravity="center"
    tools:context=".android.MainActivity">
        <Button
            android:id="@+id/button_click"
            style="@style/button"
            android:text="Clique em mim"
            />
        <TextView
            android:id="@+id/text_counter"
            style="@style/button"
            android:text="Cliques: 0" />
</LinearLayout>
EOF

echo "Projeto $APPNAME criado com core multiplataforma"
